<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />
        <link href="../css/azure-devops-ui.css?v=#{Project.AssemblyInfo.Version}#" rel="stylesheet" type="text/css" />
        <link href="../css/vis-timeline.css?v=#{Project.AssemblyInfo.Version}#" rel="stylesheet" type="text/css" />
        <link href="../css/#{Extension.Id}#-tab.css?v=#{Project.AssemblyInfo.Version}#" rel="stylesheet" type="text/css" />
    </head>
    <body class="querygantt-tab" data-bind="attr: { 'data-version': 'v' + version }">
        <div class="querygantt-tab__page bolt-page v-scroll-auto flex-column">
            <div class="page-content flex-column flex-grow">
                <my-spinner params="isVisible: isLoading"></my-spinner>
                <my-message params="text: message"></my-message>
                <div class="flex-row margin-top-16" style="display: none; position: sticky; top: 0; z-index: 3" data-bind="visible: wits().length">
                    <my-filter params="value: filter,
                                       assignees: assigneesFilter,
                                       states: statesFilter,
                                       tags: tagsFilter,
                                       areas: areasFilter,
                                       parents: parentsFilter,
                                       priorities: prioritiesFilter"></my-filter>
                </div>
                <div data-bind="with: zero">
                    <my-zero-data params="title: title, text: text"></my-zero-data>
                </div>
                <div class="flex-row margin-top-16" style="display: none" data-bind="ifnot: isLoading, visible: filteredWits().length">
                    <div class="flex-grow bolt-table-card bolt-card-with-header bolt-card flex-column depth-8 bolt-card-white">
                        <div class="bolt-card-header bolt-header bolt-header-with-commandbar bolt-header-with-back-button flex-row flex-noshrink flex-start bolt-default-horizontal-spacing bolt-header-default">
                            <button class="bolt-header-back-button justify-end bolt-button bolt-icon-button enabled subtle icon-only bolt-focus-treatment" role="button" tabindex="0" type="button" title="Expand all"
                                    data-bind="click: expand, css: { disabled: queryType() === 'flat' }">
                                <span class="fluent-icons-enabled">
                                    <span class="left-icon flex-noshrink fabric-icon ms-Icon--Add"></span>
                                </span>
                            </button>
                            <button class="bolt-header-back-button justify-end bolt-button bolt-icon-button enabled subtle icon-only bolt-focus-treatment" role="button" tabindex="0" type="button" title="Collapse all"
                                    data-bind="click: collapse, css: { disabled: queryType() === 'flat' }">
                                <span class="fluent-icons-enabled">
                                    <span class="left-icon flex-noshrink fabric-icon ms-Icon--Remove"></span>
                                </span>
                            </button>                            
                            <div class="bolt-header-content-area flex-row flex-grow flex-self-stretch">
                                <div class="bolt-header-title-area flex-column flex-grow scroll-hidden">
                                    <div class="bolt-header-title-row flex-row flex-baseline">
                                        <div class="bolt-header-title body-xl m" role="heading" data-bind="text: query.name + ' (' + filteredWits().length + ')'"></div>
                                    </div>
                                </div>
                                <div class="bolt-header-commandbar bolt-button-group flex-row justify-end">
                                    <div class="bolt-header-commandbar-button-group flex-row flex-center scroll-hidden">
                                        <button class="bolt-header-command-item-button bolt-button bolt-icon-button enabled subtle icon-only bolt-focus-treatment margin-left-8" tabindex="0" type="button" title="Refresh data"
                                                data-bind="click: refresh">
                                            <span class="fluent-icons-enabled">
                                                <span aria-hidden="true" class="left-icon flex-noshrink fabric-icon ms-Icon--Refresh medium"></span>
                                            </span>
                                        </button>
                                        <button class="bolt-header-command-item-button bolt-button bolt-icon-button enabled subtle icon-only bolt-focus-treatment margin-left-8" tabindex="0" type="button" title="Zoom out"
                                                data-bind="click: zoomOut">
                                            <span class="fluent-icons-enabled">
                                                <span aria-hidden="true" class="left-icon flex-noshrink fabric-icon ms-Icon--CircleMinus medium"></span>
                                            </span>
                                        </button>
                                        <button class="bolt-header-command-item-button bolt-button bolt-icon-button enabled subtle icon-only bolt-focus-treatment margin-left-8" tabindex="0" type="button" title="Reset zoom"
                                                data-bind="click: zoomReset">
                                            <span class="fluent-icons-enabled">
                                                <span aria-hidden="true" class="left-icon flex-noshrink fabric-icon ms-Icon--CircleDisc medium"></span>
                                            </span>
                                        </button>
                                        <button class="bolt-header-command-item-button bolt-button bolt-icon-button enabled subtle icon-only bolt-focus-treatment margin-left-8" tabindex="0" type="button" title="Zoom in"
                                                data-bind="click: zoomIn">
                                            <span class="fluent-icons-enabled">
                                                <span aria-hidden="true" class="left-icon flex-noshrink fabric-icon ms-Icon--CirclePlus medium"></span>
                                            </span>
                                        </button>
                                        <button class="bolt-header-command-item-button bolt-button bolt-icon-button enabled subtle icon-only bolt-focus-treatment margin-left-8" tabindex="0" type="button" title="Move left"
                                                data-bind="click: moveLeft">
                                            <span class="fluent-icons-enabled">
                                                <span aria-hidden="true" class="left-icon flex-noshrink fabric-icon ms-Icon--ChevronLeft medium"></span>
                                            </span>
                                        </button>
                                        <button class="bolt-header-command-item-button bolt-button bolt-icon-button enabled subtle icon-only bolt-focus-treatment margin-left-8" tabindex="0" type="button" title="Move right"
                                                data-bind="click: moveRight">
                                            <span class="fluent-icons-enabled">
                                                <span aria-hidden="true" class="left-icon flex-noshrink fabric-icon ms-Icon--ChevronRight medium"></span>
                                            </span>
                                        </button>
                                        <button class="bolt-header-command-item-button bolt-button bolt-icon-button enabled subtle icon-only bolt-focus-treatment margin-left-8" tabindex="0" type="button" title="Open configuration"
                                                data-bind="click: openSettings">
                                            <span class="fluent-icons-enabled">
                                                <span aria-hidden="true" class="left-icon flex-noshrink fabric-icon ms-Icon--Settings medium"></span>
                                            </span>
                                        </button>
                                        <button class="bolt-header-command-item-button bolt-button bolt-icon-button enabled bolt-focus-treatment margin-left-8" tabindex="0" type="button"
                                                data-bind="click: download">
                                            <span class="fluent-icons-enabled">
                                                <span class="left-icon flex-noshrink fabric-icon ms-Icon--Download medium"></span>
                                            </span>
                                            <span class="bolt-button-text body-m">XLSX</span>
                                        </button>                                        
                                        <button class="bolt-header-command-item-button bolt-button bolt-icon-button enabled bolt-focus-treatment margin-left-8" tabindex="0" type="button"
                                                data-bind="click: downloadImage">
                                            <span class="fluent-icons-enabled">
                                                <span class="left-icon flex-noshrink fabric-icon ms-Icon--Download medium"></span>
                                            </span>
                                            <span class="bolt-button-text body-m">PNG</span>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="bolt-card-content flex-row flex-grow">
                            <div class="h-scroll-auto bolt-table-container flex-grow" data-bind="if: filteredWits().length">
                                <my-timeline params="items: filteredWits,
                                                    selectedItem: current,
                                                    selectedItemId: currentId,
                                                    states: states, 
                                                    priorities: priorities, 
                                                    types: types, 
                                                    typesOther: typesOther, 
                                                    icons: icons, 
                                                    showFields: showFields,
                                                    callbacks: {
                                                        openNewWindow: openNewWindow.bind($root),
                                                        updateWit: updateWit.bind($root)
                                                    },
                                                    actions: {
                                                        expand: _timeline_expandAction,
                                                        collapse: _timeline_collapseAction,
                                                        moveLeft: _timeline_moveLeftAction,
                                                        moveRight: _timeline_moveRightAction,
                                                        zoomOut: _timeline_zoomOutAction,
                                                        zoomIn: _timeline_zoomInAction,
                                                        zoomReset: _timeline_zoomResetAction,
                                                        focus: _timeline_focusAction,
                                                        close: _timeline_closeAction,
                                                        refresh: _timeline_refreshAction,
                                                        update: _timeline_updateAction
                                                    }"></my-timeline>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- ko if: !isLoading() -->
                <div class="querygantt-tab__footer flex-row flex-wrap padding-top-16 justify-space-around">
                    <my-legend params="items: filteredWits, title: 'Effort:', reduce: (a, b) => a + b.effort || 0, format: (a) => `${a} hour(s)`, isVisible: isTotalEffortVisible"></my-legend>
                    <my-legend params="items: states, title: 'States:', itemsToInclude: statesFilter"></my-legend>
                    <my-legend params="items: priorities, title: 'Priorities:', classes: 'my-legend--square'"></my-legend>
                </div>
                <!-- /ko -->
            </div>
        </div>
        <script data-main="../js/#{Extension.Id}#-tab.js?v=#{Project.AssemblyInfo.Version}#" src="../js/libs/require.js"></script>
    </body>
</html>